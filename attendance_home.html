<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Domáci tím</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>

<body>

<h1>DOMÁCI - <span id="teamName"></span></h1>
<p> Dochádzka hráčov </p>

<div class="table-scroll">
<table>
  <thead>
    <tr>
      <th>TU</th>
      <th>Meno</th>
      <th>Číslo</th>
    </tr>
  </thead>
  <tbody id="playersBody"></tbody>
</table>
</div>

<button id="continueBtn" class="action-btn" disabled> ✓ </button>

<script>
const params = new URLSearchParams(window.location.search);
const team = params.get("home");

const tbody = document.getElementById("playersBody");
const teamNameEl = document.getElementById("teamName");
const button = document.getElementById("continueBtn");

teamNameEl.innerText = team;

async function loadPlayers() {
  try {
    const res = await fetch(
      "https://lucifer21sk.pythonanywhere.com/players/" + encodeURIComponent(team)
    );
    const players = await res.json();

    tbody.innerHTML = "";

    players.forEach(p => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><input type="checkbox" class="player"></td>
        <td>${p.name}</td>
        <td>${p.number}</td>
      `;
      tbody.appendChild(row);
    });

    attachCheckboxEvents();

  } catch (err) {
    alert("Cannot load players from server");
    console.error(err);
  }
}

function attachCheckboxEvents() {
  const checkboxes = document.querySelectorAll('.player');

  function updateButton() {
    const checkedCount = document.querySelectorAll('.player:checked').length;

    if (checkedCount >= 5) {
      button.disabled = false;
      button.classList.add('enabled');
    } else {
      button.disabled = true;
      button.classList.remove('enabled');
    }
  }

  checkboxes.forEach(cb => {
    cb.addEventListener('change', updateButton);
  });
}

button.addEventListener('click', () => {
  const url =
    `attendance_away.html?home=${encodeURIComponent(params.get("home"))}&away=${encodeURIComponent(params.get("away"))}`;
  window.location.href = url;
});

loadPlayers();
</script>

</body>
</html>
