<!DOCTYPE html>
<html lang="sk">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inline Hokej Zápas</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="teams">
    <div class="team">
      <h2>DOMÁCI</h2>
      <select id="homeTeam">
        <option value="">Vybrať tím</option>
      </select>
    </div>

    <div class="team">
      <h2>HOSTIA</h2>
      <select id="awayTeam">
        <option value="">Vybrať tím</option>
      </select>
    </div>
  </div>

  <div class="start">
    <button id="startBtn" class="action-btn" disabled>✓</button>
  </div>

  <script>
    // =========================
    // CONFIG
    // =========================
    const API_URL = "https://Lucifer21sk.pythonanywhere.com/teams";

    // =========================
    // DOM ELEMENTS
    // =========================
    const homeSelect = document.getElementById("homeTeam");
    const awaySelect = document.getElementById("awayTeam");
    const startBtn   = document.getElementById("startBtn");

    // =========================
    // STATE CHECK
    // =========================
    function checkReady() {
      const homeVal = homeSelect.value;
      const awayVal = awaySelect.value;

      console.log("checkReady:", homeVal, awayVal);

      startBtn.disabled = !(
        homeVal !== "" &&
        awayVal !== "" &&
        homeVal !== awayVal
      );
    }

    // =========================
    // LOAD TEAMS
    // =========================
    async function loadTeams() {
      try {
        // Reset UI state
        homeSelect.innerHTML = '<option value="">Vybrať tím</option>';
        awaySelect.innerHTML = '<option value="">Vybrať tím</option>';
        startBtn.disabled = true;

        const response = await fetch(API_URL);
        if (!response.ok) {
          throw new Error("HTTP error " + response.status);
        }

        const teams = await response.json();
        console.log("Loaded teams:", teams);

        teams.forEach(team => {
          const optHome = document.createElement("option");
          optHome.value = String(team.id);   // IDs stay as strings in HTML
          optHome.textContent = team.name;

          const optAway = document.createElement("option");
          optAway.value = String(team.id);
          optAway.textContent = team.name;

          homeSelect.appendChild(optHome);
          awaySelect.appendChild(optAway);
        });

      } catch (err) {
        console.error("Failed to load teams:", err);
        alert("Nepodarilo sa načítať tímy zo servera");
      }
    }

    // =========================
    // EVENT LISTENERS
    // =========================
    homeSelect.addEventListener("change", checkReady);
    awaySelect.addEventListener("change", checkReady);

    startBtn.addEventListener("click", () => {
      const homeId = homeSelect.value;
      const awayId = awaySelect.value;

      // Safety guard (should never trigger now)
      if (!homeId || !awayId || homeId === awayId) {
        return;
      }

      window.location.href =
        `attendance_home.html?home=${homeId}&away=${awayId}`;
    });

    // =========================
    // INIT
    // =========================
    window.addEventListener("DOMContentLoaded", loadTeams);
  </script>

</body>
</html>
