<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Koniec zápasu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="post-container">

  <h1 class="post-title">Koniec zápasu</h1>

  <div class="post-form">

    <div class="form-group">
      <label>Rozhodca</label>
      <input type="text" id="referee">
    </div>

    <div class="form-group">
      <label>Lekár</label>
      <input type="text" id="doctor">
    </div>

    <div class="form-group">
      <label>Poznámky</label>
      <textarea></textarea>
    </div>

    <button class="post-save-btn" onclick="finishApp()">
      Uložiť
    </button>

  </div>

</div>

<script>
async function finishApp() {
  const params = new URLSearchParams(window.location.search);
  const matchId = params.get("match");

  if (!matchId) {
    alert("Chýba ID zápasu");
    return;
  }

  const referee = document.getElementById("referee").value;
  const doctor = document.getElementById("doctor").value;
  const notes = document.getElementById("notes").value;

  try {
    await fetch(
      "https://Lucifer21sk.pythonanywhere.com/matches/report",
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          match_id: matchId,
          referee: referee,
          doctor: doctor,
          notes: notes
        })
      }
    );

    // End of whole flow → back to start
    window.location.href = "select_teams.html";

  } catch (err) {
    console.error("Saving match report failed", err);
    alert("Nepodarilo sa uložiť zápis zápasu");
  }
}
</script>

</body>

</html>
